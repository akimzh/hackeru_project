HackerU Final Project
2020-09-30

# Описание программы
Программа по сбору статистических данных цен на квартиры в Казахстане с возможностью просмотра отчетов через браузер:
1. Квартиры, которые подешевели
2. Районы, которые дорожают
3. Новые квартиры

Далее приведены инструкции по установке, запуску программы и работе с ней.    
Все инструкции приведены для MacOS.    

# Установка
1. Создать папку на диске
2. Сохранить в нее файлы
3. Создать виртуальное окружение:    
    1. Запустить "Командная строка"    
    2. Перейти в рабочую папку (созданная на шаге 1)    
    3. Создать виртуальное окружение    
        ```
            python -m venv env    
        ```
    4. Активировать виртуальное окружение    
       ```
           > source env/bin/activate  
       ```
    :exclamation: Все дальнейшие действия выполняются через командую строку только в виртуальном окружении.    
1. Обновить pip install:    
    ```
    python -m pip install --upgrade pip    
    ```
2. Установить BeautifulSoap:    
    ```
    pip install beautifulsoup4    
    ```
3. Установить SQLite3:    
    ```
    pip install db-sqlite3    
    ```
4. Установить requests:    
    ```
    pip install requests    
    ```
5. Установить PANDAS:    
    ```
    pip install pandas    
    ```
6. Установить FLASK:    
    ```
    pip install flask    
    ```
7. Установить unidecode
    ```
    pip install unidecode    
    ```
Можно выгрузить все библиотеки с помощью готового списка необходимых библиотек:
    ```
    pip install -r req.txt  
    ```
# Запуск программы    
При первом запуске программа создает необходимые для ее работы объекты базы данных.    
Программой не предусмотрена автоматическая загрузка данных.    
Загрузка данных инициируется пользователем.    
    
Чтобы запустить программу на выполнение, необходимо:    
1. В командой строке в рабочей директории выполнить    
    ``` 
    python app.py    
    ``` 
2. Последней строчкой программа выведет адрес для подключения:
    ``` 
    Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
    ``` 
    
# Работа программы через браузер    
## Описание возможных действий    
Программа позволяет выполнить следующие действия:    
1. **Загрузка данных в базу**    
    При загрузке данных анализируется, есть ли уже такой объект в базе.    
    Если объект новый, то он сохраняется в базе.    
    Если объект уже зарегистрирован в базе, то анализируется наличие изменения хотя бы в одном атрибуте, и в этом случае предыдущие значения объекта сохраняются в архиве.    
    Если же в системе есть объекты, по которым информация не получена, то объект считается удаленным из базы. При повторном получении объекта он будет считаться как новый.    

## Загрузка данных    
Чтобы выполнить очередную загрузку данных по районам необходимо:    
1. В браузере перейти по ссылке
    ``` 
    http://127.0.0.1:5000/api/get_data_by_location/<location>
    ``` 
2. При успешном выполнении загрузки данных в браузере будет выведен JSON данных по районам
 
Иначе будет выведено сообщение об ошибке и текст ошибки:
    ```
    {"status": "error", "error_text": "some error text"}
    ```    

## Просмотр списка представлений из базы    
    В программе предусмотрена возможность просмотреть весь список доступных отчетов. 
    Для этого ввести в адресной строке браузера: 
    ``` 
    http://127.0.0.1:5000/api/get_view_from_db/<view>
    ```   
    В программе предусмотрено несколько отчетов:      
    1. Квартиры, которые подешевели    
        Выводится список объектов, цена которых уменьшилась относительно предыдущей загрузки.    
    2. Районы, которые подорожали    
        Выводится список районов, итоговая сумма объектов которых изменилась в большую сторону.    
    3. Новые квартиры    
        Выводится список объектов, впервые полученные при последней загрузке.    
    ``` 
    :exclamation: служебная опция
    <view>:
	v_flat_01 - Новые квартиры 
	v_flat_02 - Квартиры, которые подешевели 
	v_flat_03 - Районы, которые подорожали 
    ``` 
